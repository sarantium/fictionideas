
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Product Ideas from Fiction">
      
      
        <meta name="author" content="Ashvin">
      
      
        <link rel="canonical" href="https://www.fictionideas.com/w2/">
      
      
        <link rel="prev" href="../w1/">
      
      
        <link rel="next" href="../kiln/">
      
      
      <link rel="icon" href="../assets/view-grid-plus-outline-dark.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Plan Agent - Fiction Ideas</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#query-plan" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Fiction Ideas" class="md-header__button md-logo" aria-label="Fiction Ideas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 3v8h8V3h-8M3 21h8v-8H3v8M3 3v8h8V3H3m10 13h3v-3h2v3h3v2h-3v3h-2v-3h-3v-2Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Fiction Ideas
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Plan Agent
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Fiction Ideas" class="md-nav__button md-logo" aria-label="Fiction Ideas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 3v8h8V3h-8M3 21h8v-8H3v8M3 3v8h8V3H3m10 13h3v-3h2v3h3v2h-3v3h-2v-3h-3v-2Z"/></svg>

    </a>
    Fiction Ideas
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../machineusers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Users
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../productivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Productivity
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../creativity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creativity
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workflows
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../w0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../w1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Goal Agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Plan Agent
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Plan Agent
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Query plan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kiln/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    One Hour PM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Stories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GlimmerCraft
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ChronoCuisine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WhimsiQuill
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LustraGem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glintroam Odyssey Tours
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SteamCraft Innovations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mystique & Masquerade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Galactic Questers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cosmos Canvas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AquaTents üéµ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Haiku Harmonics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Whispering Gardens üìΩÔ∏è
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Celestial Harmonics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gravitational Harmony Homes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caf√©-Oruga Comms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MoodHues Chapeau
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fyrestoke Hearth & Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Waxen Calm üéµ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nether's Bane
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sleight of Hand Academy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rattle's Raid Rides üéµüìΩÔ∏è
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SwiftTrade üí≤
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gadgetarium
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Twilight Grove
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/25/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wisdom Keeper ü™û
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/26/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seshatian Vault ü™û
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stories/30/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    InkLinks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Query plan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Plan Agent</h1>

<div class="admonition tip">
<p class="admonition-title">Goal</p>
<p><strong>Given a context, create and optimise a plan</strong></p>
</div>
<div class="admonition tip">
<p class="admonition-title">User story</p>
<ol>
<li>I want to create a  plan so that I can <strong>structure and sequence my workflow</strong></li>
<li>I want to optimise a plan so that my workflow is <strong>cheaper, faster or better</strong></li>
</ol>
</div>
<div class="admonition example">
<p class="admonition-title">Variations</p>
<ul>
<li>create and optimise a query plan</li>
<li>create and optimise a task plan</li>
</ul>
</div>
<div class="admonition danger">
<p class="admonition-title">Note</p>
<p>Plan agents don't execute plan actions or answer plan questions. That requires a separate agent or workflow.</p>
</div>
<h2 id="query-plan">Query plan</h2>
<p>A query plan breaks down a parent question into sub-questions. I find there are two ways to do this. A single step is often sufficient to generate a query plan. Optionally, adding two further steps - generating a list of suggestions then implementing them to revise the query plan - results in a more refined and precise output.</p>
<h3 id="step-1">Step 1</h3>
<p>The single step query plan below uses the following group of Pydantic classes</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">QueryType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enumeration representing the types of queries that can be asked to a question answer system.&quot;&quot;&quot;</span>

    <span class="n">SINGLE_QUESTION</span> <span class="o">=</span> <span class="s2">&quot;SINGLE&quot;</span>
    <span class="n">MERGE_MULTIPLE_RESPONSES</span> <span class="o">=</span> <span class="s2">&quot;MERGE_MULTIPLE_RESPONSES&quot;</span>

<span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing a single question in a query plan.&quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Unique id of the query&quot;</span><span class="p">)</span>
    <span class="n">question</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Question asked using a question answering system&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">dependencies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List of sub questions that need to be answered before asking this question&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">node_type</span><span class="p">:</span> <span class="n">QueryType</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">QueryType</span><span class="o">.</span><span class="n">SINGLE_QUESTION</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Type of question, either a single question or a multi-question merge&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">class</span> <span class="nc">QueryPlan</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container class representing a tree of questions to ask a question answering system.&quot;&quot;&quot;</span>

    <span class="n">query_graph</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Query</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The query graph representing the plan&quot;</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Query</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the dependencies of a query given their ids.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_graph</span> <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
</code></pre></div>
<h4 id="example">Example</h4>
<div class="admonition tip">
<p class="admonition-title">Input : System Prompt</p>
<p>You are a world class query planning algorithm capable of breaking apart questions into its dependency queries such that the answers can be used to inform the parent question.Do not answer the questions, simply provide a correct compute graph with good specific questions to ask and relevant dependencies. Your compute graph should both decompose and recompose queries in order to answer the parent question. Before you call the function, think step-by-step to get a better understanding of the problem.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Input : User Prompt</p>
<p>Consider the following question :  How have Japanese and Chinese tea ceremonies impacted the cultivation and production techniques of Matcha and Pu-erh, and how has globalisation altered these ancient traditions?.</p>
<p>Generate the correct, complete query plan to answer this parent question</p>
</div>
<div class="highlight"><pre><span></span><code>&quot;Output&quot;

{&#39;query_graph&#39;: [{&#39;id&#39;: 1,
   &#39;question&#39;: &#39;What are the characteristics of Japanese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 2,
   &#39;question&#39;: &#39;What are the characteristics of Chinese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 3,
   &#39;question&#39;: &#39;What are the cultivation and production techniques of Matcha?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 4,
   &#39;question&#39;: &#39;What are the cultivation and production techniques of Pu-erh?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 5,
   &#39;question&#39;: &#39;How have Japanese tea ceremonies influenced the cultivation and production techniques of Matcha?&#39;,
   &#39;dependencies&#39;: [1, 3],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 6,
   &#39;question&#39;: &#39;How have Chinese tea ceremonies influenced the cultivation and production techniques of Pu-erh?&#39;,
   &#39;dependencies&#39;: [2, 4],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 7,
   &#39;question&#39;: &#39;How has globalization impacted Japanese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [1],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 8,
   &#39;question&#39;: &#39;How has globalization impacted Chinese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [2],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 9,
   &#39;question&#39;: &#39;How has globalization influenced the cultivation and production techniques of Matcha?&#39;,
   &#39;dependencies&#39;: [3],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 10,
   &#39;question&#39;: &#39;How has globalization influenced the cultivation and production techniques of Pu-erh?&#39;,
   &#39;dependencies&#39;: [4],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 11,
   &#39;question&#39;: &#39;How have Japanese and Chinese tea ceremonies impacted the cultivation and production techniques of Matcha and Pu-erh?&#39;,
   &#39;dependencies&#39;: [5, 6],
   &#39;node_type&#39;: &lt;QueryType.MERGE_MULTIPLE_RESPONSES: &#39;MERGE_MULTIPLE_RESPONSES&#39;&gt;},
  {&#39;id&#39;: 12,
   &#39;question&#39;: &#39;How has globalization altered these ancient traditions?&#39;,
   &#39;dependencies&#39;: [7, 8],
   &#39;node_type&#39;: &lt;QueryType.MERGE_MULTIPLE_RESPONSES: &#39;MERGE_MULTIPLE_RESPONSES&#39;&gt;},
  {&#39;id&#39;: 13,
   &#39;question&#39;: &#39;Merge final findings: How have Japanese and Chinese tea ceremonies impacted the cultivation and production techniques of Matcha and Pu-erh, and how has globalization altered these ancient traditions?&#39;,
   &#39;dependencies&#39;: [11, 9, 10, 12],
   &#39;node_type&#39;: &lt;QueryType.MERGE_MULTIPLE_RESPONSES: &#39;MERGE_MULTIPLE_RESPONSES&#39;&gt;}]}
</code></pre></div>
<h3 id="step-2">Step 2</h3>
<p>As the name implies, the suggestion list class generates a list of improvements to the compute graph without implementing the recommendations.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SuggestionList</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A detailed list of suggestions to optimise the query plan&quot;&quot;&quot;</span>

    <span class="n">suggestions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>
<h4 id="example_1">Example</h4>
<div class="admonition tip">
<p class="admonition-title">Input : System Prompt</p>
<p>You are a highly sophisticated query optimization algorithm designed to enhance the quality of query plans.
Your primary function is not to answer the queries but to meticulously improve the query graph.
This involves ensuring each step is clearly defined and leverages detailed dependencies to construct a comprehensive and precise query sequence.
Before making any modifications, thoroughly evaluate the existing query plan to identify opportunities where additional or more detailed questions or steps could enhance clarity or add value.
Your output should detail an optimised query graph where each question is well-defined and logically sequenced based on its dependencies.
Ensure no loss of necessary detail and increase the questions or steps where it adds to the robustness and precision of the information-gathering process.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Input : User Prompt</p>
<p>[Add in the query plan generated earlier]</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Output</p>
<ul>
<li>Insert a guiding node comparing the overall tea ceremonies before discussing their influence on cultivation and production techniques.</li>
<li>Add nodes to analyze broad categories for different types of tea other than Matcha and Pu-erh to provide context about other tea influences.</li>
<li>Introduce a node discussing significant historical periods impacting tea ceremonies and their relations before globalization discussion.</li>
<li>Implement query nodes which explore the more contemporary aspects of tea ceremonies, delving into modernization and adaptation in global contexts.</li>
<li>Create more detailed dependency links between globalization impacts on tea ceremonies and specific changes in cultivation techniques.</li>
</ul>
</div>
<h3 id="step-3">Step 3</h3>
<p>After generating the list of suggestions, send this back to the LLM along with the query plan to generate a revised plan. It uses the same Pydantic class as the original Query Plan for structuring the response.</p>
<h4 id="example_2">Example</h4>
<div class="admonition tip">
<p class="admonition-title">Input : System prompt</p>
<p>[Same as system prompt in Multi step A]</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Input : User Prompt</p>
<ul>
<li>Consider the original parent question : {insert question here}</li>
<li>Consider the list of suggestions for optimising the query plan: {insert list of suggestions here}.</li>
<li>Apply them to improve the original query plan : {insert original query plan here}.</li>
<li>Generate a revised, optimised query plan to answer the parent question.</li>
<li>Query Ids and dependencies should be listed sequentially.</li>
</ul>
</div>
<div class="highlight"><pre><span></span><code>Output

{&#39;query_graph&#39;: [{&#39;id&#39;: 1,
   &#39;question&#39;: &#39;What are the characteristics of Japanese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 2,
   &#39;question&#39;: &#39;What are the characteristics of Chinese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 3,
   &#39;question&#39;: &#39;What are the cultivation and production techniques of Matcha?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 4,
   &#39;question&#39;: &#39;What are the cultivation and production techniques of Pu-erh?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 5,
   &#39;question&#39;: &#39;A comparison of Japanese and Chinese tea ceremonies.&#39;,
   &#39;dependencies&#39;: [1, 2],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 6,
   &#39;question&#39;: &#39;What are the cultivation and production techniques of other significant tea types?&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 7,
   &#39;question&#39;: &#39;Historical overview of significant periods impacting tea ceremonies.&#39;,
   &#39;dependencies&#39;: [],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 8,
   &#39;question&#39;: &#39;How have Japanese tea ceremonies influenced the cultivation and production techniques of Matcha?&#39;,
   &#39;dependencies&#39;: [1, 3],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 9,
   &#39;question&#39;: &#39;How have Chinese tea ceremonies influenced the cultivation and production techniques of Pu-erh?&#39;,
   &#39;dependencies&#39;: [2, 4],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 10,
   &#39;question&#39;: &#39;How has globalization impacted Japanese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [1],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 11,
   &#39;question&#39;: &#39;How has globalization impacted Chinese tea ceremonies?&#39;,
   &#39;dependencies&#39;: [2],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 12,
   &#39;question&#39;: &#39;How has globalization influenced the cultivation and production techniques of Matcha?&#39;,
   &#39;dependencies&#39;: [3],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 13,
   &#39;question&#39;: &#39;How has globalization influenced the cultivation and production techniques of Pu-erh?&#39;,
   &#39;dependencies&#39;: [4],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 14,
   &#39;question&#39;: &#39;How have Japanese and Chinese tea ceremonies impacted the cultivation and production techniques of Matcha and Pu-erh?&#39;,
   &#39;dependencies&#39;: [8, 9],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 15,
   &#39;question&#39;: &#39;How has globalization altered these ancient traditions?&#39;,
   &#39;dependencies&#39;: [10, 11],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 16,
   &#39;question&#39;: &#39;Modernization and adaptation in global contexts related to tea ceremonies.&#39;,
   &#39;dependencies&#39;: [15],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 17,
   &#39;question&#39;: &#39;Linking globalization impacts on tea ceremonies to specific changes in cultivation techniques.&#39;,
   &#39;dependencies&#39;: [12, 13, 14],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;},
  {&#39;id&#39;: 18,
   &#39;question&#39;: &#39;Merge final findings: How have Japanese and Chinese tea ceremonies impacted the cultivation and production techniques of Matcha and Pu-erh, and how has globalization altered these ancient traditions?&#39;,
   &#39;dependencies&#39;: [14, 16, 17],
   &#39;node_type&#39;: &lt;QueryType.SINGLE_QUESTION: &#39;SINGLE&#39;&gt;}]}
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023-2024 Ashvin Parameswaran
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://ashvin.au" target="_blank" rel="noopener" title="ashvin.au" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 7h2v3.33L13 7h2l-3 5 3 5h-2l-2-3.33V17H9V7m3-5a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8 8 8 0 0 0-8-8Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>